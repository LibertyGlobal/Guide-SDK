/**
 * Liberty Global TV Guide SDK (Angular version) - A utility library for the Liberty Global Schedule APIs
 * @version v0.5.0
 * @link 
 * @license MIT
 */
angular.module("lgi.guide",["$http"]).factory("Guide",["$http",function($http){"use strict";function Evaluable(value,context,separator){this.value=value,this.context=context,this.separator=separator||""}function Expression(field,operation,value){Evaluable.call(this,value,field,operation)}function RequestBuilder(resource,region,baseURL,appId,appKey,request,ids){if(!isNonEmptyString(region))throw new TypeError("Invalid region");if(!isNonEmptyString(baseURL))throw new TypeError("Invalid baseURL");if(!isNonEmptyString(appId))throw new TypeError("Invalid appId");if(!isNonEmptyString(appKey))throw new TypeError("Invalid appKey");if(!isFunction(request))throw new TypeError("Invalid request function");var fields=[],filters=[],sorting=Evaluable.from(null),skip=0,limit=0;this.fields=function(values){return values=normalizeVariadic(arguments).map(Evaluable.from),fields=fields.concat(values),this},this.filter=function(values){return values=normalizeVariadic(arguments).map(Evaluable.from),filters=filters.concat(values),this},this.sortBy=function(field,order){return field=Evaluable.from(field),order=isString(order)&&"desc"===order.toLowerCase()?"desc":"asc",sorting=new Expression(field,"","("+order+")"),this},this.skip=function(value){return isPositiveNumber(value)&&(skip=value),this},this.limit=function(value){return isPositiveNumber(value)&&(limit=value),this},this.execute=function(onSuccess,onError){if(exists(onSuccess)){if(!isFunction(onSuccess))throw new TypeError("Invalid onSuccess callback")}else onSuccess=function(){};if(exists(onError)){if(!isFunction(onError))throw new TypeError("Invalid onError callback")}else onError=function(){};var url=this.toString(),headers={"X-Auth-Id":appId,"X-Auth-Key":appKey};request(url,headers,onSuccess,onError)},this.toString=function(){var url=baseURL+"/"+region+"/"+resource.endpoint,query=[];ids&&ids.length&&(url+="/"+ids.join(","));var evaluatedFields=fields.map(function(field){return field.evaluate(resource)});evaluatedFields.length&&query.push("fields="+evaluatedFields.join(","));var evaluatedFilters=filters.map(function(filter){return filter.evaluate(resource)});evaluatedFilters.length&&(query=query.concat(evaluatedFilters));var evaluatedSort=sorting.evaluate(resource);return evaluatedSort&&query.push("sort="+evaluatedSort),skip&&query.push("skip="+skip),limit&&query.push("limit="+limit),url+".json?"+query.join("&")}}function Resource(name,endpoint){this.name=name,this.endpoint=endpoint}function Field(context,name){Evaluable.call(this,name,context,".")}function NumericField(context,name){Field.call(this,context,name)}function TextField(context,name){Field.call(this,context,name)}function FuzzyMatchField(context,name){TextField.call(this,context,name)}function MultiValueField(context,name){TextField.call(this,context,name)}var and=function(predicates){return predicates=Array.prototype.slice.call(arguments),function(){var values=arguments;return predicates.every(function(predicate){return predicate.apply(null,values)})}},not=function(fn){return function(){return fn.apply(null,arguments)===!1}},exists=function(value){return"undefined"!=typeof value&&null!==value},hasLength=function(value){return value.length>0},isNumeric=function(value){return"number"==typeof value},isNumber=and(isNumeric,not(isNaN),isFinite),isPositive=function(value){return value>=0},isPositiveNumber=and(isNumber,isPositive),isString=function(value){return"string"==typeof value},isNonEmptyString=and(isString,hasLength),isFunction=function(value){return"function"==typeof value},isObject=function(value){return Object(value)===value},isArray=function(value){return"[object Array]"===Object.prototype.toString.call(value)},isArguments=function(value){return"[object Arguments]"===Object.prototype.toString.call(value)},isInstanceOf=function(value,type){return value instanceof type},toArray=function(value){return Array.prototype.slice.call(value,0)},normalizeVariadic=function(value){if(!isArray(value)&&!isArguments(value))return[];switch(value.length){case 0:return[];case 1:return isArray(value[0])?value[0]:[value[0]];default:return toArray(value)}};Evaluable.from=function(value){return isInstanceOf(value,Evaluable)?value:new Evaluable(value)},Evaluable.prototype.evaluate=function(context){return exists(this.context)&&isFunction(this.context.evaluate)?this.context===context?this.value:[this.context.evaluate(context),this.value].join(this.separator):this.value},Expression.prototype=Object.create(Evaluable.prototype),Resource.prototype.evaluate=function(){return this.name},Field.prototype=Object.create(Evaluable.prototype),NumericField.prototype=Object.create(Field.prototype),NumericField.prototype.isLessThan=function(value){return new Expression(this,"<",value)},NumericField.prototype.isLessThanOrEqualTo=function(value){return new Expression(this,"<=",value)},NumericField.prototype.isEqualTo=function(value){return new Expression(this,"=",value)},NumericField.prototype.isGreaterThanOrEqualTo=function(value){return new Expression(this,">=",value)},NumericField.prototype.isGreaterThan=function(value){return new Expression(this,">",value)},TextField.prototype=Object.create(Field.prototype),TextField.prototype.isEqualTo=function(value){return new Expression(this,"=",value)},FuzzyMatchField.prototype=Object.create(TextField.prototype),FuzzyMatchField.prototype.matches=function(value){return new Expression(this,"~",value)},MultiValueField.prototype=Object.create(TextField.prototype),MultiValueField.prototype.isIn=function(values){return values=arguments,new Expression(this,"=",normalizeVariadic(values).join(","))};var Broadcast=new Resource("broadcast","broadcasts");Broadcast.IMI=new Field(Broadcast,"imi"),Broadcast.START=new NumericField(Broadcast,"start"),Broadcast.END=new NumericField(Broadcast,"end"),Broadcast.CHANNEL=new Field(Broadcast,"channel"),Broadcast.BUZZ_PER_MINUTE=new NumericField(Broadcast,"statistics.bpm"),Broadcast.POPULARITY=new NumericField(Broadcast,"statistics.popularity");var Channel=new Resource("channel","channels");Channel.REF=new MultiValueField(Channel,"ref"),Channel.NAME=new FuzzyMatchField(Channel,"name"),Channel.POSITION=new NumericField(Channel,"logicalPosition"),Channel.LOGO_LINK=new Field(Channel,"logoLink"),Channel.OPENGRAPH_LINK=new Field("opengraphLink");var Video=new Resource("video","videos");Video.CRID=new Field(Video,"crid"),Video.TITLE=new FuzzyMatchField(Video,"title"),Video.SHORT_SYNOPSIS=new Field(Video,"shortSynopsis"),Video.SYNOPSIS=new Field(Video,"synopsis"),Video.CATEGORY=new FuzzyMatchField(Video,"category"),Video.SEASON=new NumericField(Video,"season"),Video.EPISODE=new NumericField(Video,"episode"),Video.STATISTICS=new Field(Video,"statistics"),Video.AGE_RATING=new TextField(Video,"ageRating"),Video.CAST=new Field(Video,"cast"),Video.DIRECTORS=new Field(Video,"directors"),Video.WRITERS=new Field(Video,"writers"),Video.IMAGE_LINK=new Field(Video,"imageLink"),Video.OPENGRAPH_LINK=new Field(Video,"opengraphLink"),Video.RECORD_LINK=new Field(Video,"recordLink");var Guide={settings:{baseURL:"http://test.appdev.io/kraken/v2/schedule/data",region:"",appId:"",appKey:""},initialize:function(settings){if(!isObject(settings))throw new TypeError("Invalid configuration object");if(!isNonEmptyString(settings.region))throw new TypeError("Invalid region code");if(!isNonEmptyString(settings.appId))throw new TypeError("Invalid app id");if(!isNonEmptyString(settings.appKey))throw new TypeError("Invalid app key");this.settings.region=settings.region,this.settings.appId=settings.appId,this.settings.appKey=settings.appKey},findBroadcasts:function(ids){return ids=normalizeVariadic(arguments),new RequestBuilder(Broadcast,this.settings.region,this.settings.baseURL,this.settings.appId,this.settings.appKey,Guide.request,ids)},findVideos:function(ids){return ids=normalizeVariadic(arguments),new RequestBuilder(Video,this.settings.region,this.settings.baseURL,this.settings.appId,this.settings.appKey,Guide.request,ids)},findChannels:function(ids){return ids=normalizeVariadic(arguments),new RequestBuilder(Channel,this.settings.region,this.settings.baseURL,this.settings.appId,this.settings.appKey,Guide.request,ids)}};return Guide.Broadcast=Broadcast,Guide.Video=Video,Guide.Channel=Channel,Guide.request=function(url,headers,onSuccess,onError){var settings={method:"GET",url:url,headers:headers};$http(settings).success(onSuccess).error(onError)},Guide}]);