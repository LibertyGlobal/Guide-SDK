// Kraken SDK
// ----------------------------------
// v0.2.7
//
// Copyright (c) 2013 Liberty Global
// Distributed under BSD license

!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.kraken=a.K=b()}(this,function(){function a(){this.initialRequestURL="",this.nextBatchLink=""}function b(a){this._name=a}function c(a){b.call(this,a)}function d(a){b.call(this,a)}function e(a,c){b.call(this,a),this.prefixString=c}function f(a,c){b.call(this,a),this.prefixString=c}function g(a){this.items=[],"undefined"!=typeof a&&this.add(a)}function h(){g.call(this),this.filters=[],this._queryModificationActions=[],this._requestURL="",this._request=new a}var i={},j=i;j.utils={addFactory:function(a){a.create=function(){return new a}}};var k=function(){function a(a,b){var c=document.createElement("script"),e=!1;c.src=a,c.async=!0;var f=b||g.error;c.onerror="function"==typeof f?function(b){f({url:a,event:b})}:function(){console.warn("KrakenSDK: Error during request to "+a)},c.onload=c.onreadystatechange=function(){e||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(e=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c))},d||(d=document.getElementsByTagName("head")[0]),d.appendChild(c)}function b(a,b){var c=a.split("?");if(c.length>=2){for(var d=c.shift(),e=c.join("?"),f=encodeURIComponent(b)+"=",g=e.split(/[&;]/g),h=g.length;h-->0;)-1!==g[h].lastIndexOf(f,0)&&g.splice(h,1);a=d+"?"+g.join("&")}return a}function c(c,d,h){var i=-1===(c||"").indexOf("?")?"?":"&";h=h||g.callbackName||"callback";var j=h+"_json"+ ++e;return c=b(c,h),f[j]=function(a){d(a);try{delete f[j]}catch(b){}f[j]=null},a(c+i+h+"="+j),j}var d,e=0,f=this,g={};return c},l=function(){function a(a,b,c){var d=require("http"),e=require("url"),f=e.parse(a,!0),g={host:f.hostname,port:80,method:"GET",path:f.path},h=d.request(g,function(a){a.on("data",function(a){b(JSON.parse(a))})});h.end(),h.on("error",function(b){c?c(b):console.warn("KrakenSDK: Error during request to "+a)})}return a},m=function(){return"undefined"!=typeof module&&module.exports?l():k()},n=m();return j.config={APIURL:"http://appdev.io/kraken/v2/schedule/",region:""},a.prototype.execute=function(a,b,c){var d=[];this.initialRequestURL=a,n(a,this.createScopedCallback(b,c,d))},a.prototype.proceedResponse=function(a,b,c,d){c=c.concat(a.data),this.nextBatchLinkURL=a.nextBatchLink?a.nextBatchLink.href:void 0,void 0!==b&&b--,(b>0||void 0===b)&&void 0!==this.nextBatchLinkURL?n(this.nextBatchLinkURL,this.createScopedCallback(d,b,c)):d.bind(this)(c,a)},a.prototype.createScopedCallback=function(a,b,c){var d=function(d){this.proceedResponse(d,b,c,a)};return d.bind(this)},b.prototype.toString=function(){return this._name},b.prototype._getStringForOperation=function(a,b){return this._name+a+b},b.prototype._getURLModificationObject=function(a,b){var c={};return c.stringValue=b,c.context=this,c.actionFunction=a,c},c.prototype=Object.create(b.prototype),c.prototype.equalTo=function(a){return this._getStringForOperation("=",a)},c.prototype.greaterThan=function(a){return this._getStringForOperation(">",a)},c.prototype.greaterThanOrEqualTo=function(a){return this._getStringForOperation(">=",a)},c.prototype.lessThan=function(a){return this._getStringForOperation("<",a)},c.prototype.lessThanOrEqualTo=function(a){return this._getStringForOperation("<=",a)},d.prototype=Object.create(b.prototype),d.prototype.equalTo=function(a){return this._getStringForOperation("=",a)},d.prototype.isMatching=function(a){return this._getStringForOperation("~",a)},e.prototype=Object.create(b.prototype),e.prototype.equalTo=function(a){return this._getURLModificationObject(this._modifyURL,a)},e.prototype._modifyURL=function(a,b){var c=a.lastIndexOf("/"),d="/"+this.prefixString+"/"+b;return a=a.substr(0,c)+d+a.substr(c)},f.prototype=Object.create(b.prototype),f.prototype.equalTo=function(a){return this._getURLModificationObject(this._modifyURL,a)},f.prototype._modifyURL=function(a,b){var c=-1!==a.indexOf("?")?a.indexOf("?"):a.length,d=a.substring(0,c),e=a.substring(0,d.lastIndexOf("/")),f="/"+this.prefixString+"/"+b+".json";return a.replace(d,e+f)},g.prototype.each=function(a){this.items.forEach(a)},g.prototype.where=function(a){var b=Object.keys(a);return this.items.filter(function(c){return b.every(function(b){return c.hasOwnProperty(b)&&c[b]===a[b]})})},g.prototype.add=function(a){"[object Array]"===Object.prototype.toString.call(a)?this.items=this.items.concat(a):this.items.push(a)},g.prototype.get=function(a){return this.items[a]},g.prototype.toArray=function(){return this.items.slice(0)},h.prototype=Object.create(g.prototype),h.prototype.limit=function(a){return this._addURLModification("maxBatchSize="+a),this},h.prototype.fields=function(){return this._addURLModification("show="+Array.prototype.slice.call(arguments).join(",")),this},h.prototype.sort=function(a,b){if(("undefined"==typeof b||null===b)&&(b="asc"),"asc"!==b&&"desc"!==b)throw new Error('Invalid sort option, expecting "asc" or "desc"');return this._addURLModification("sort="+a+"("+b+")"),this},h.prototype.filter=function(){for(var a=0;a<arguments.length;a++)this._addURLModification(arguments[a]),this.filters.push(arguments[a]);return this},h.prototype.findOne=function(a){return this._buildURLFromElements(),this._request.execute(this._requestURL,this._createScopedCallback(a),1),this},h.prototype.findNext=function(a){return this._request.execute(this._request.nextBatchLink||this._buildURLFromElements(),this._createScopedCallback(a),1),this},h.prototype.findAll=function(a){return this._buildURLFromElements(),this._request.execute(this._requestURL,this._createScopedCallback(a)),this},h.prototype._addURLModification=function(a){this._queryModificationActions.push(a)},h.prototype._buildURLFromElements=function(){this._requestURL=j.config.APIURL,""!==j.config.region&&(this._requestURL+="regions/"+j.config.region+"/"),this._requestURL+=this._baseURL;for(var a=0;a<this._queryModificationActions.length;a++)if(this._queryModificationActions[a].actionFunction)this._requestURL=this._executeModificationAction(this._queryModificationActions[a]);else{var b="&";0===a&&(b=""),this._requestURL+=b+this._queryModificationActions[a]}return this._requestURL},h.prototype._executeModificationAction=function(a){return a.actionFunction.apply(a.context,[this._requestURL,a.stringValue])},h.prototype._processData=function(a){this.add(a)},h.prototype._processResponse=function(a){this.filters=a.filter,this.sortings=a.order},h.prototype._createScopedCallback=function(a){var b=function(b,c){this._processData(b),this._processResponse(c),a.bind(this)(b)};return b.bind(this)},j.Broadcast=function(){h.call(this),void 0===i.config.region&&console.warn("Please, specify region before sending requests to Broadcasts endpoint.")},j.Broadcast.ID=new f("id","broadcasts"),j.Broadcast.START=new c("start"),j.Broadcast.END=new c("end"),j.Broadcast.CRID=new d("crid"),j.Broadcast.IMI=new d("imi"),j.Broadcast.CHANNEL=new d("channel"),j.Broadcast.CHANNEL_REF=new e("channel.ref","channels"),j.Broadcast.STATISTICS=new d("statistics"),j.Broadcast.VIDEO_ID=new d("videoId"),j.Broadcast.IMDB_ID=new d("imdbId"),j.Broadcast.YEAR=new c("year"),j.Broadcast.TITLE=new d("title"),j.Broadcast.SYNOPSIS=new d("synopsis"),j.Broadcast.CATEGORY=new d("category"),j.Broadcast.OPENGRAPH_LINK=new d("opengraphLink"),j.Broadcast.SELF_LINK=new d("selfLink"),j.Broadcast.CAST=new d("cast"),j.Broadcast.DIRECTORS=new d("directors"),j.Broadcast.WRITERS=new d("writers"),j.Broadcast.EPISODE=new c("episode"),j.Broadcast.SEASON=new c("season"),j.Broadcast.IMAGE_LINK=new c("imageLink"),j.Broadcast.MORE_LINK=new d("moreLink"),j.Broadcast.prototype=Object.create(h.prototype),j.Broadcast.prototype._baseURL="broadcasts.json?",j.utils.addFactory(j.Broadcast),j.Channel=function(){h.call(this),void 0===i.config.region&&console.warn("Please, specify region before sending requests to Channel endpoint.")},j.Channel.REF=new d("ref"),j.Channel.NAME=new d("name"),j.Channel.SYNOPSIS=new d("synopsis"),j.Channel.LOGICAL_POSITION=new c("logicalPosition"),j.Channel.LOGO_LINK=new d("logoLink"),j.Channel.BROADCASTS_LINK=new d("broadcastsLink"),j.Channel.OPENGRAPH_LINK=new d("opengraphLink"),j.Channel.SELF_LINK=new d("selfLink"),j.Channel.GENRES=new d("genres"),j.Channel.BROADCASTS=new d("broadcasts"),j.utils.addFactory(j.Channel),j.Channel.prototype=Object.create(h.prototype),j.Channel.prototype._baseURL="channels.json?",j.Region=function(){h.call(this)},j.Region.ID=new d("id"),j.Region.NAME=new d("name"),j.Region.CATEGORIES=new d("categories"),j.Region.CHANNEL_LINEUP_LINK=new d("channelLineupLink"),j.Region.SELF_LINK=new d("selfLink"),j.Region.TOP_BROADCASTS_LINK=new d("topBroadcastsLink"),j.Region.TOP_VIDEOS_LINK=new d("topVideosLink"),j.utils.addFactory(j.Region),j.Region.prototype=Object.create(h.prototype),j.Region.prototype._baseURL="regions.json?",j});