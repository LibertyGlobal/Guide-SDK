// LGI TV Guide JS SDK
// ----------------------------------
// v0.4.3
//
// Copyright (c) 2014 Liberty Global
// Distributed under BSD license

!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):(a.LGI={},a.LGI.Guide=b())}(this,function(){function a(){this.initialRequestURL="",this.nextBatchLink=""}function b(a){this._name=a}function c(a){b.call(this,a)}function d(a){b.call(this,a)}function e(a,c){b.call(this,a),this.prefixString=c}function f(a,c){b.call(this,a),this.prefixString=c}function g(a){this.items=[],"undefined"!=typeof a&&this.add(a)}function h(){g.call(this),this.filters=[],this._queryModificationActions=[],this._requestURL="",this._request=new a}var i={};i.Guide={},i.Guide.utils={addFactory:function(a){a.create=function(){return new a}}};var j=function(){function a(){}function b(b,c,d){var e=new XMLHttpRequest;"function"!=typeof c&&(c=a),"function"!=typeof d&&(d=a),e.open("GET",b),e.setRequestHeader("app_id","dc573c37"),e.setRequestHeader("app_key","f4521ced0cb9af73374731a77b2f21f6"),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var a,b=e.responseText;if("object"==typeof b&&b)a=b;else{if("string"!=typeof b||!b)return void d(new Error("Invalid JSON response received"));try{a=JSON.parse(b)}catch(f){return void d(new Error("Invalid JSON response received"))}}c(a)}},e.onerror=function(){d(new Error("An error occurred while retrieving data (status "+e.status+")"))},e.ontimeout=function(){d(new Error("Request timed out"))},e.send(null)}return b},k=function(){function a(a,b,c){-1===a.indexOf("http:")&&(a="http:"+a);var d=require("http"),e=require("url"),f=e.parse(a,!0),g={host:f.hostname,port:80,method:"GET",path:f.path},h=d.request(g,function(a){a.on("data",function(a){b(JSON.parse(a))})});h.end(),h.on("error",function(b){c?c(b):console.warn("KrakenSDK: Error during request to "+a)})}return a},l=function(){return"undefined"!=typeof module&&module.exports?k():j()},m=l();return i.Guide.config={APIURL:"http://api.lgi.io/kraken/v2/schedule/",region:""},a.prototype.execute=function(a,b,c){var d=[];this.initialRequestURL=a,m(a,this.createScopedCallback(b,c,d))},a.prototype.proceedResponse=function(a,b,c,d){c=c.concat(a.data),this.nextBatchLink=a.nextBatchLink?a.nextBatchLink.href:void 0,void 0!==b&&b--,(b>0||void 0===b)&&void 0!==this.nextBatchLink&&this.nextBatchLink?m(this.nextBatchLink,this.createScopedCallback(d,b,c)):void 0!==d&&d.bind(this)(c,a)},a.prototype.createScopedCallback=function(a,b,c){var d=function(d){this.proceedResponse(d,b,c,a)};return d.bind(this)},b.prototype.toString=function(){return this._name},b.prototype._getStringForOperation=function(a,b){return this._name+a+b},b.prototype._getURLModificationObject=function(a,b){var c={};return c.stringValue=b,c.context=this,c.actionFunction=a,c},c.prototype=Object.create(b.prototype),c.prototype.equalTo=function(a){return this._getStringForOperation("=",a)},c.prototype.greaterThan=function(a){return this._getStringForOperation(">",a)},c.prototype.greaterThanOrEqualTo=function(a){return this._getStringForOperation(">=",a)},c.prototype.lessThan=function(a){return this._getStringForOperation("<",a)},c.prototype.lessThanOrEqualTo=function(a){return this._getStringForOperation("<=",a)},d.prototype=Object.create(b.prototype),d.prototype.equalTo=function(a){return this._getStringForOperation("=",a)},d.prototype.isMatching=function(a){return this._getStringForOperation("~",a)},e.prototype=Object.create(b.prototype),e.prototype.equalTo=function(a){return this._getURLModificationObject(this._modifyURL,a)},e.prototype._modifyURL=function(a,b){var c=a.lastIndexOf("/"),d="/"+this.prefixString+"/"+b;return a=a.substr(0,c)+d+a.substr(c)},f.prototype=Object.create(b.prototype),f.prototype.equalTo=function(a){return this._getURLModificationObject(this._modifyURL,a)},f.prototype._modifyURL=function(a,b){var c=-1!==a.indexOf("?")?a.indexOf("?"):a.length,d=a.substring(0,c),e=a.substring(0,d.lastIndexOf("/")),f="/"+this.prefixString+"/"+b+".json";return a.replace(d,e+f)},g.prototype.each=function(a){this.items.forEach(a)},g.prototype.where=function(a){var b=Object.keys(a);return this.items.filter(function(c){return b.every(function(b){return c.hasOwnProperty(b)&&c[b]===a[b]})})},g.prototype.add=function(a){"[object Array]"===Object.prototype.toString.call(a)?this.items=this.items.concat(a):this.items.push(a)},g.prototype.get=function(a){return this.items[a]},g.prototype.toArray=function(){return this.items.slice(0)},g.prototype.reset=function(){return this.items=[],this.items},h.prototype=Object.create(g.prototype),h.prototype.limit=function(a){return this._addURLModification("limit="+a),this},h.prototype.fields=function(){return this._addURLModification("fields="+Array.prototype.slice.call(arguments).join(",")),this},h.prototype.sort=function(a,b){if(("undefined"==typeof b||null===b)&&(b="asc"),"asc"!==b&&"desc"!==b)throw new Error('Invalid sort option, expecting "asc" or "desc"');return this._addURLModification("sort="+a+"("+b+")"),this},h.prototype.filter=function(){for(var a=0;a<arguments.length;a++)this._addURLModification(arguments[a]),this.filters.push(arguments[a]);return this},h.prototype.findOne=function(a){return this._buildURLFromElements(),this._request.execute(this._requestURL,this._createScopedCallback(a),1),this},h.prototype.findNext=function(a){return this._request.execute(this._request.nextBatchLink||this._buildURLFromElements(),this._createScopedCallback(a),1),this},h.prototype.findAll=function(a){return this._buildURLFromElements(),this._request.execute(this._requestURL,this._createScopedCallback(a)),this},h.prototype._addURLModification=function(a){this._queryModificationActions.push(a)},h.prototype._buildURLFromElements=function(){this._requestURL=i.Guide.config.APIURL,void 0!==this._URLprefix&&(this._requestURL+=this._URLprefix),""!==i.Guide.config.region&&(this._requestURL+=i.Guide.config.region+"/"),this._requestURL+=this._baseURL;for(var a=0;a<this._queryModificationActions.length;a++)if(this._queryModificationActions[a].actionFunction)this._requestURL=this._executeModificationAction(this._queryModificationActions[a]);else{var b="&";0===a&&(b=""),this._requestURL+=b+this._queryModificationActions[a]}return this._requestURL},h.prototype._executeModificationAction=function(a){return a.actionFunction.apply(a.context,[this._requestURL,a.stringValue])},h.prototype._processData=function(a){this.add(a)},h.prototype._processResponse=function(a){this.filters=a.filter||this.filters,this.sortings=a.order||this.sortings},h.prototype._createScopedCallback=function(a){var b=function(b,c){this._processData(b),this._processResponse(c),void 0!==a&&a.bind(this)(b)};return b.bind(this)},i.Guide.Broadcast=function(){h.call(this),void 0===i.Guide.config.region&&console.warn("Please, specify region before sending requests to Broadcasts endpoint.")},i.Guide.Broadcast.ID=new f("id","broadcasts"),i.Guide.Broadcast.START=new c("start"),i.Guide.Broadcast.END=new c("end"),i.Guide.Broadcast.CRID=new d("video.crid"),i.Guide.Broadcast.IMI=new d("imi"),i.Guide.Broadcast.CHANNEL=new d("channel"),i.Guide.Broadcast.CHANNEL_NAME=new d("channel.name"),i.Guide.Broadcast.VIDEO_ID=new d("video.id"),i.Guide.Broadcast.TITLE=new d("video.title"),i.Guide.Broadcast.SYNOPSIS=new d("video.synopsis"),i.Guide.Broadcast.AGE_RATING=new d("video.ageRating"),i.Guide.Broadcast.CATEGORY=new d("video.category"),i.Guide.Broadcast.RECORD_LINK=new d("video.recordLink"),i.Guide.Broadcast.CAST=new d("video.cast"),i.Guide.Broadcast.DIRECTORS=new d("video.directors"),i.Guide.Broadcast.WRITERS=new d("video.writers"),i.Guide.Broadcast.IMAGE_LINK=new c("video.imageLink"),i.Guide.Broadcast.BPM=new c("statistics.bpm"),i.Guide.Broadcast.POPULARITY=new c("statistics.popularity"),i.Guide.utils.addFactory(i.Guide.Broadcast),i.Guide.Broadcast.prototype=Object.create(h.prototype),i.Guide.Broadcast.prototype._baseURL="broadcasts.json?",i.Guide.Broadcast.prototype._URLprefix="data/",i.Guide.Channel=function(){h.call(this),void 0===i.Guide.config.region&&console.warn("Please, specify region before sending requests to Channel endpoint.")},i.Guide.Channel.REF=new d("ref"),i.Guide.Channel.NAME=new d("name"),i.Guide.Channel.LOGICAL_POSITION=new c("logicalPosition"),i.Guide.Channel.LOGO_LINK=new d("logoLink"),i.Guide.Channel.BROADCASTS_LINK=new d("broadcastsLink"),i.Guide.Channel.OPENGRAPH_LINK=new d("opengraphLink"),i.Guide.Channel.SELF_LINK=new d("selfLink"),i.Guide.Channel.GENRES=new d("genres"),i.Guide.Channel.BROADCASTS=new d("broadcasts"),i.Guide.utils.addFactory(i.Guide.Channel),i.Guide.Channel.prototype=Object.create(h.prototype),i.Guide.Channel.prototype._baseURL="channels.json?",i.Guide.Channel.prototype._URLprefix="data/",i.Guide.Region=function(){h.call(this)},i.Guide.Region.ID=new d("id"),i.Guide.Region.NAME=new d("name"),i.Guide.Region.SUBREGIONS=new d("subregions"),i.Guide.Region.GENRES=new d("genres"),i.Guide.Region.CATEGORIES=new d("categories"),i.Guide.Region.CHANNEL_LINEUP_LINK=new d("channelLineupLink"),i.Guide.Region.SELF_LINK=new d("selfLink"),i.Guide.Region.TOP_BROADCASTS_LINK=new d("topBroadcastsLink"),i.Guide.Region.TOP_VIDEOS_LINK=new d("topVideosLink"),i.Guide.utils.addFactory(i.Guide.Region),i.Guide.Region.prototype=Object.create(h.prototype),i.Guide.Region.prototype._baseURL="regions.json?",i.Guide.Video=function(){h.call(this),void 0===i.Guide.config.region&&console.warn("Please, specify region before sending requests to Video endpoint.")},i.Guide.Video.ID=new f("id","videos"),i.Guide.Video.TITLE=new d("title"),i.Guide.Video.SYNOPSIS=new d("synopsis"),i.Guide.Video.CATEGORY=new d("category"),i.Guide.Video.SEASON=new c("season"),i.Guide.Video.EPISODE=new c("episode"),i.Guide.Video.CRID=new d("crid"),i.Guide.Video.STATISTICS=new d("statistics"),i.Guide.Video.AGE_RATING=new d("ageRating"),i.Guide.Video.IMAGE_LINK=new d("imageLink"),i.Guide.Video.OPENGRAPH_LINK=new d("opengraphLink"),i.Guide.Video.SELF_LINK=new d("selfLink"),i.Guide.Video.CAST=new d("cast"),i.Guide.Video.DIRECTORS=new d("directors"),i.Guide.Video.WRITERS=new d("writers"),i.Guide.Video.BPM=new c("statistics.bpm"),i.Guide.Video.POPULARITY=new c("statistics.popularity"),i.Guide.Video.MORE_LINK=new d("moreLink"),i.Guide.utils.addFactory(i.Guide.Video),i.Guide.Video.prototype=Object.create(h.prototype),i.Guide.Video.prototype._baseURL="videos.json?",i.Guide.Video.prototype._URLprefix="data/",i.Guide});